# yaml-language-server: $schema=https://raw.githubusercontent.com/Azure/azure-dev/main/schemas/v1.0/azure.yaml.json

name: neo4j-mcp-samples
metadata:
  template: neo4j-mcp-samples@0.0.1

# Serverless infrastructure - AI Services + Project + Model Deployments
infra:
  provider: bicep
  path: infra
  module: main

hooks:
  preprovision:
    shell: sh
    run: |
      # Azure AI Foundry serverless models are available in select regions.
      ALLOWED_REGIONS="eastus2 swedencentral westus2 westus3"

      if ! echo "$ALLOWED_REGIONS" | grep -qw "$AZURE_LOCATION"; then
        echo ""
        echo "ERROR: Region '$AZURE_LOCATION' is not supported."
        echo ""
        echo "Azure AI Foundry requires one of these regions:"
        echo "  - eastus2       (East US 2)"
        echo "  - swedencentral (Sweden Central)"
        echo "  - westus2       (West US 2)"
        echo "  - westus3       (West US 3)"
        echo ""
        echo "To fix, run: azd env set AZURE_LOCATION eastus2"
        echo "Then retry:  azd up"
        echo ""
        exit 1
      fi
      echo "Region '$AZURE_LOCATION' is supported."
  postprovision:
    shell: sh
    run: |
      echo ""
      echo "=========================================="
      echo "  Azure AI Infrastructure deployed!"
      echo "=========================================="
      echo ""
      echo "Next steps:"
      echo "  1. Run: uv run python setup_env.py"
      echo "  2. Deploy MCP server (from project root): ./scripts/deploy.sh"
      echo "  3. Copy MCP_ENDPOINT and MCP_API_KEY from MCP_ACCESS.json to .env"
      echo "  4. Run samples: cd langgraph-mcp-agent && uv run python simple-agent.py"
      echo ""
